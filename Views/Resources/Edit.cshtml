@model ResourceBooking.Models.Resource

@{
    ViewData["Title"] = "Edit Resource";
}

<h2>Edit Resource</h2>

<hr />
<div class="row">
    <div class="col-md-6">
        <form asp-action="Edit" method="post">
            <div asp-validation-summary="All" class="text-danger mb-3"></div>
            <input type="hidden" asp-for="Id" />
            
            <div class="form-group mb-3">
                <label asp-for="Name" class="control-label"></label>
                <input asp-for="Name" class="form-control" required maxlength="200" />
                <span asp-validation-for="Name" class="text-danger"></span>
            </div>
            
            <div class="form-group mb-3">
                <label asp-for="Description" class="control-label"></label>
                <textarea asp-for="Description" class="form-control" rows="3" maxlength="1000"></textarea>
                <span asp-validation-for="Description" class="text-danger"></span>
            </div>
            
            <div class="form-group mb-3">
                <label asp-for="Location" class="control-label"></label>
                <input asp-for="Location" class="form-control" maxlength="200" />
                <span asp-validation-for="Location" class="text-danger"></span>
            </div>
            
            <div class="form-group mb-3">
                <label asp-for="Capacity" class="control-label"></label>
                <input asp-for="Capacity" class="form-control" type="number" min="1" max="1000" required />
                <span asp-validation-for="Capacity" class="text-danger"></span>
            </div>
            
            <div class="form-check mb-3">
                <input class="form-check-input" asp-for="IsAvailable" id="isAvailable" />
                <label class="form-check-label" asp-for="IsAvailable">
                    Is Available for Booking
                </label>
            </div>
            
            <!-- Unavailability Section -->
            <div id="unavailabilitySection" style="display: @(Model.IsAvailable ? "none" : "block");">
                <div class="card border-warning mb-3">
                    <div class="card-header bg-warning text-dark">
                        <h6 class="mb-0"><i class="bi bi-exclamation-triangle"></i> Unavailability Details</h6>
                    </div>
                    <div class="card-body">
                        <div class="form-group mb-3">
                            <label asp-for="UnavailabilityType" class="control-label">Reason Type</label>
                            <select asp-for="UnavailabilityType" class="form-select">
                                <option value="">Select reason type...</option>
                                <option value="0">Maintenance</option>
                                <option value="1">Repairs</option>
                                <option value="2">Damaged</option>
                                <option value="3">Cleaning</option>
                                <option value="4">Renovation</option>
                                <option value="5">Other</option>
                            </select>
                        </div>
                        
                        <div class="form-group mb-3">
                            <label asp-for="UnavailabilityReason" class="control-label">Detailed Reason</label>
                            <textarea asp-for="UnavailabilityReason" class="form-control" rows="2" maxlength="500" 
                                      placeholder="Provide more details about why this resource is unavailable..."></textarea>
                        </div>
                        
                        <div class="form-group mb-3">
                            <label asp-for="UnavailableUntil" class="control-label">Available Again On</label>
                            <input asp-for="UnavailableUntil" type="datetime-local" class="form-control" />
                            <small class="form-text text-muted">Leave empty if availability date is unknown</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <input type="submit" value="Save Changes" class="btn btn-primary" />
                <a asp-action="Index" class="btn btn-secondary">Back to List</a>
            </div>
        </form>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5>Edit Guidelines</h5>
            </div>
            <div class="card-body">
                <ul class="list-unstyled small">
                    <li><i class="bi bi-check-circle-fill text-success"></i> Name is required and must be unique</li>
                    <li><i class="bi bi-check-circle-fill text-success"></i> Capacity must be at least 1</li>
                    <li><i class="bi bi-check-circle-fill text-success"></i> Use "Is Available" to enable/disable bookings</li>
                    <li><i class="bi bi-check-circle-fill text-success"></i> Changes affect future bookings only</li>
                </ul>
                
                <div class="mt-3">
                    <h6 class="small">Unavailability Types:</h6>
                    <div class="small text-muted">
                        <span class="badge bg-warning text-dark me-1">Maintenance</span>
                        <span class="badge bg-danger me-1">Repairs</span>
                        <span class="badge bg-danger me-1">Damaged</span>
                        <span class="badge bg-info me-1">Cleaning</span>
                        <span class="badge bg-secondary me-1">Renovation</span>
                        <span class="badge bg-dark">Other</span>
                    </div>
                </div>
                
                <div class="alert alert-info py-2 mt-3">
                    <small>
                        <strong>Tip:</strong> Mark as "Unavailable" for maintenance instead of deleting. Provide specific reasons to help users understand why the resource can't be booked.
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const isAvailableCheckbox = document.getElementById('isAvailable');
            const unavailabilitySection = document.getElementById('unavailabilitySection');
            
            function toggleUnavailabilitySection() {
                if (isAvailableCheckbox.checked) {
                    unavailabilitySection.style.display = 'none';
                } else {
                    unavailabilitySection.style.display = 'block';
                }
            }
            
            // Listen for changes
            isAvailableCheckbox.addEventListener('change', toggleUnavailabilitySection);
            
            // Form submission debugging
            document.querySelector('form').addEventListener('submit', function(e) {
                console.log('Resource edit form submitted');
                console.log('Name:', document.getElementById('Name').value);
                console.log('Capacity:', document.getElementById('Capacity').value);
                console.log('IsAvailable:', isAvailableCheckbox.checked);
                console.log('UnavailabilityType:', document.querySelector('select[name="UnavailabilityType"]').value);
                console.log('UnavailabilityReason:', document.querySelector('textarea[name="UnavailabilityReason"]').value);
            });
        });
    </script>
}